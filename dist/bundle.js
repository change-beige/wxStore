!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).main=e()}(this,(function(){"use strict";function t(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,u(r.key),r)}}function o(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function i(t){return function(t){if(Array.isArray(t))return f(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||a(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){if(t){if("string"==typeof t)return f(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(t,e):void 0}}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function u(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var s=function(t){return"object"===e(t)&&!!t},c=function(t){if("string"!=typeof t)throw new TypeError("the event name must be string type")},l=function(t){if("function"!=typeof t)throw new TypeError("the event callback must be function type")},y=l,h=c,v=function(){function t(){n(this,t),this.eventMap={}}return o(t,[{key:"on",value:function(t,e,n){h(t),y(e);var r=this.eventMap[t];return r||(r=[],this.eventMap[t]=r),r.push({fn:e,thisArg:n}),this}},{key:"emit",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return h(t),(this.eventMap[t]||[]).forEach((function(t){t.fn.apply(t.thisArg,n)})),this}},{key:"once",value:function(t,e,n){var r=this;h(t),y(e);return this.on(t,(function o(){r.off(t,o);for(var i=arguments.length,a=new Array(i),f=0;f<i;f++)a[f]=arguments[f];e.apply(n,a)}),n)}},{key:"off",value:function(t,e){h(t),y(e);var n=this.eventMap[t];if(n){for(var r=i(n),o=0;o<r.length;o++){var a=r[o];if(a.fn===e){var f=r.indexOf(a);n.splice(f,1)}}0===n.length&&delete this.eventMap[t]}}}]),t}(),p=v,b=s,d=l,m=c,w=p,g=function(){function t(e){if(n(this,t),!b(e.state))throw new TypeError("the state must be object type");if(!e.actions&&b(e.actions)){for(var r=0,o=Object.values(e.actions);r<o.length;r++){var i=o[r];d(i)}this.actions=e.actions}this.state=e.state,this.observe(e.state),this.event=new w,this.event2=new w}return o(t,[{key:"observe",value:function(t){var e=this;Object.keys(t).forEach((function(n){var r=t[n];Object.defineProperty(t,n,{get:function(){return r},set:function(t){r!==t&&(r=t,e.event.emit(n,r),e.event2.emit(n,function(t,e,n){return(e=u(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}({},n,r)))}})}))}},{key:"onState",value:function(t,e){if(-1===Object.keys(this.state).indexOf(t))throw new Error("the state does not contain your ".concat(t));d(e),this.event.on(t,e),e.apply(this.state,[this.state[t]])}},{key:"onStates",value:function(t,e){var n,r=Object.keys(this.state),o={},i=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=a(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,f=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return f=t.done,t},e:function(t){u=!0,i=t},f:function(){try{f||null==n.return||n.return()}finally{if(u)throw i}}}}(t);try{for(i.s();!(n=i.n()).done;){var f=n.value;if(-1===r.indexOf(f))throw new Error("the state does not contain your ".concat(f));this.event2.on(f,e),o[f]=this.state[f]}}catch(t){i.e(t)}finally{i.f()}e.apply(this.state,[o])}},{key:"setState",value:function(t,e){this.state[t]=e}},{key:"dispatch",value:function(t){if(m(t),-1===Object.keys(this.actions).indexOf(t))throw new Error("this action name does not exist in action of store");for(var e=this.actions[t],n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];e.apply(this,[this.state].concat(r))}},{key:"offState",value:function(t,e){if(-1===Object.keys(this.state).indexOf(t))throw new Error("the state not contain the key");d(e),this.event.off(t,e)}},{key:"offStates",value:function(t,e){var n=this,r=Object.keys(this.state);t.forEach((function(t){if(-1===r.indexOf(t))throw new Error("the state does not contain your ".concat(t));n.eventV2.off(t,e)}))}}]),t}();return t({EventBus:p,store:g})}));
